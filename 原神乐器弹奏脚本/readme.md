# 乐谱格式的说明

[TOC]

--------------

##  一、 使用须知

本文档将对507编写的原神演奏程序使用的乐谱接口进行说明，便于他人读谱和编谱。该原神乐器演奏程序由507个人开发，目前只分享给了几个朋友。该程序仅供娱乐，不为他人的任何使用后果负责，包括游戏封号、电脑故障等。

乐谱中所有的符号都是半角符号，包括加减号、括号等。

乐谱编写的格式较为讲究，如果有不小心编写错的地方，可能导致整个程序的崩溃。

乐谱演奏完后程序会自动退出。

使用方法：程序打开后，会检测当前文件夹下的子文件夹“乐谱”中的所有文本文件并编号，在程序输入框中输入对应序号，程序会给3秒的等待时间，此时用户可以切到原神的演奏界面。3秒后，演奏自动开始。

----------

## 二、 基本格式

~~乐谱必须命名为"`乐谱.txt`"并放在和演奏程序同一个文件夹下。~~新版中，需要在程序同一个文件夹下新建一个名为"乐谱"的文件夹，程序会自动读取里面的所有文本文件(txt)并编号，输入对应序号即可演奏。

乐谱的第一行为演奏时一拍的时间间隔，单位为秒。通过调整该数字可以改变整个曲子的曲速。在曲速过快的情况下可能会出现程序bug。

乐谱的其他行为实际的演奏内容。你可以将乐谱内容写在一行，也可以写成很多行，换行和空格会被程序自动忽略，对程序运行没有影响。但是，程序的最后一行必须是空行（或者说，在打完最后一个音符后，必须额外加入一个回车），否则最后一个音符会不能演奏出来。

为了方便乐谱的编写调试，可以使用井号$\#$对乐谱内容进行注释，作用效果范围为一行。

----------------

## 三、 音高的表示

为了理解方便，音高直接用数字1到7表示。原神里的音高跨越3个8度，以中间一行的do为中央C，即中间一行的do re mi fa so la xi分别用数字表示为：
$$
1 2 3 4 5 6 7
$$
如果要提高一个八度，则在音符前加上加号，如$+1$表示高八度的do，反之，降一个八度则填一个减号，如$-1$表示低八度的do。

如果遇到休止符，则用数字$0$进行表示。注意，休止符前不能加上加减号。

-----

## 四、节拍的表示

 对于一个单拍音符，可以直接输入数字。如果音符为1/2拍，则需要在前面加入一个下划线$\_$，如果是1/4拍则加入两个下划线$\_\_$。

考虑到原神里的乐器不能弹奏长音，则长音建议写成一个单拍音节后序加上休止符。

需要注意的是，下划线只作用于单个音符。比如有下面的简谱：
$$
12\underline{34\underline{56}}
$$
则在乐谱文件中应该写成：
$$
12\_3\_4\_\_5\_\_6
$$

如果进一步，加三个下划线，可以形成1/8拍，以此类推。

同时，可以使用叹号$!$来表示1/3拍，可用于三连音。叹号和下划线可以叠加且顺序无关，如$!\_$表示1/6拍，$\_!\_$表示1/12拍。

-------

## 五、 和弦的表示

对于和弦，可以将和弦中的所有音符用一个括号括起来，从而使得这些音符同时演奏，如：
$$
(135)(246)
$$
上面的写法会使得do mi so同时演奏，接着re fa la同时演奏。

这个功能很容易受到电脑性能的影响。如果有卡比，可能会使得音符演奏有一定的时间差。如果是这样，建议不要使用和弦，而是在简谱的和弦中，找到音调最低的那个音作为替代。

-----------

## 六、 结合的优先级

在上述规则中，一共有三类符号可以与数字结合：音高符号$+/-$、节拍符号$\_/!$、和弦符号$()$，其中，结合优先级最高的为音高符号，其次为和弦符号，最次为节拍符号。也就是说，我们首先会让音高符号与数字结合，形成实际的音高，接着再加入和弦符号，获得每一个需要发出的音，最后加入节拍符号，确定每个音发出的时间点。

比如下面一段简谱：
$$
\underline{
\left(\begin{matrix}
\dot1\\
\dot2
\end{matrix}\right)
\dot 3
\underline{
\dot 4
\left(\begin{matrix}
\dot5\\
\dot6
\end{matrix}\right)}}
$$
应该写成:
$$
\_(+1+2)\_+3\_\_+4\_\_(+5+6)
$$

------

## 七、 示例乐谱：两只老虎

```txt
0.6
1231123134503450
_5_6_5_431_5_6_5_431
1-5101-510

```

注意第一行是节拍间隔，最后一行必须是空行。